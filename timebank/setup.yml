# Author: A.Bacchus
# Date : 03/30/2021
# Description : This playbook was created to setup the timebank software

---
- hosts: localhost
  
  vars:
    user: hourworld
    password: "hourworld"
  tasks:

  - name: create user
    user:
      name: "{{ user }}"
      password: "{{ password }}"
    ignore_errors: yes
    become: true

  - name: Stop/Disbale firewaal
    command: "{{ item }}"
    with_items:
      - systemctl stop firewalld
      - systemctl disable firewalld
      - setenforce 0
    ignore_errors: yes
    become: true

  - name: Ensure SELinux is set to permissive mode
    lineinfile:
      path: /etc/selinux/config
      regexp: '^SELINUX='
      line: SELINUX=permissive
  
  - name: Install and start apache
    command: "{{ item }}"
    with_items:
      - dnf install httpd
      - systemctl enable httpd
      - systemctl start httpd
    become: true

  - name: Install php packages
    command: "dnf install {{ item }} -y"
    with_items:
      - https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
      - https://rpms.remirepo.net/enterprise/remi-release-8.rpm
      - php56
      - php56-php-mbstring
      - php56-php-mysql
      - php56-php-gd
      - php56-php-apcu
      - php56-php-fpm
    become: true

  - name: Enable/Start fpm
    command: "{{ item }}"
    with_items:
      - systemctl enable php56-php-fpm
      - systemctl start php56-php-fpm
    become: true